<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>SPA Title</title>
</head>
<body>
        <!-- Your HTML goes here -->
        <script id="car-template" type="text/template">
        	<div><%= type %></div>
        </script>

        <script id="home-template" type="text/template">
            <div> this is <%= page %>page view</div>
        </script>


        <script id="about-template" type="text/template">
            <div> this is <%= page %>page view </div>
        </script>

        <div id="car"></div>
        <div id="main">
            
        </div>
        <script src="scripts/lib/jquery.min.js"></script>
        <script src="scripts/lib/underscore-min.js"></script>
        <script src="scripts/lib/backbone-min.js"></script>
        <!-- Your scripts go here -->
        <script type="text/javascript">
        	var Car = Backbone.Model.extend({
        		initialize: function() {
        			this.on("change", function() {
        				console.log("Model was changed");
        			});
        			this.on("change:type", function() {
        				console.log("Model the attribute was changed");
        			});
        		},
        		defaults: {
        			speed: 0,
        			type: "no type"
        		},
        		validate: function(attrs, options) {
        			if (!attrs.type) {
        				return "A car must have a type!";
        			}
        		},
        		print: function() {
        			console.log(JSON.stringify(this));
        		}

        	});

        	var CarList = Backbone.Collection.extend({
        		model: Car
        	});

        	var CarView = Backbone.View.extend({
        		model: Car,
        		el: "#car",
        		template: _.template($('#car-template').html()),
		        initialize: function() {
		            console.log("car view initialized");
                    this.on("myCustomEvent", this.callback);
				},
        		events: {
        			"click #changeSpeed": "changeSpeed"
        		},
        		render: function() {
        			this.$el.html(this.template(this.model.toJSON()));
        			return this;
        		},
        		changeSpeed: function() {
        			this.model.set("speed", this.model.get("speed") + 10);
        		},
                callback: function() {
                    console.log("my view's custom event triggered");
                }
        	});

        	// var bmw = new Car({ type: "bmw", id: 1, speed: 100});
        	// var honda = new Car({ type: "honda", id: 2, speed: 80});
         //    var carList = new CarList();

         //    var carView = new CarView();
         //    carView.trigger("myCustomEvent");

         //    carList.on("add", function(car) {
         //        console.log("adding " + car.get("type"));
         //    });

         //    carList.on("remove", function(car) {
         //        console.log("removing " + car.get("type"));
         //    });

         //    carList.on("change", function(car) {
         //        console.log(car.get("type") + " changed");
         //    });


         //    carList.each(function(car){
         //        console.log(car.get("type"));
         //    });

         //    var filteredCars = carList.filter(function(car){
         //        return car.get("speed") > 90;
         //    });

         //    carList.add([bmw, honda]);

         //    carList.remove(honda);

         //    bmw.set("speed", 80);


         //    var evtAggregator = _.extend({}, Backbone.Events);

         //    function handler() {
         //        console.log("handler triggered");
         //    }

         //    evtAggregator.on("myCustomEvent", handler);

         //    evtAggregator.trigger("myCustomEvent");

         //    evtAggregator.off("myCustomEvent", handler);

         //    evtAggregator.trigger("myCustomEvent");

         //    var a = _.extend({}, Backbone.Events);
         //    var b = _.extend({}, Backbone.Events);

         //    a.listenTo(b, "myCustomEvent", function() {
         //        console.log("a saw that b's myCustomEvent was triggered")
         //    });

         //    b.trigger("myCustomEvent");

         //    a.stopListening();


         //    var AppRouter = Backbone.Router.extend({
         //        routes: {
         //            "": "home",
         //            "about": "about",
         //            "car/:id": "car"
         //        },
         //        home: function() {
         //            console.log("home route triggered");
         //        },
         //        about: function() {
         //            console.log("about route triggered");
         //        },
         //        car: function(id) {
         //            console.log("car route triggered with id: " + id);
         //        }
         //    });


         //    var router = new AppRouter();
         //    Backbone.history.start({silent: true, pushState: true});

         //    // router.route("car/:id", "car");
         //    router.navigate("car/1", {trigger: true});

         //    router.navigate("about", {trigger: true});

            var HomeView = Backbone.View.extend({
                template: _.template($('#home-template').html()),
                initialize: function() {
                    console.log("home-page view initialized");
                },
                render: function() {
                    this.$el.html(this.template({ page: "home" }));
                    console.log(this.$el);
                    return this;
                },
            });

            var AboutView = Backbone.View.extend({
                template: _.template($('#about-template').html()),
                initialize: function() {
                    console.log("about-page view initialized");
                },
                render: function() {
                    this.$el.html(this.template({ page: "about" }));
                    return this;
                },
            });

            var AppRouter = Backbone.Router.extend({
                routes: {
                    "": "home",
                    "about": "about"
                },
                home: function() {
                    console.log("home page visited");
                    var view = new HomeView();
                    console.log(view.render().el);
                    $('#main').html(view.render().el);
                },
                about: function() {
                    console.log("about page visited");
                    var view = new AboutView();
                    $('#main').html(view.render().el);
                }
            });
            var router = new AppRouter();
            Backbone.history.start({pushState: true});
            // router.navigate("", {trigger: true});
            // router.navigate("about", {trigger: true});
        </script>
</body>
</html>